<!-- Starter code and data adapted from http://duspviz.mit.edu/d3-workshop/mapping-data-with-d3/ -->
<html>

<head>
    <title>A Basic D3 map</title>
    <!-- <script src="http://d3js.org/d3.v4.js" charset="utf-8"></script> -->
    <script src="https://d3js.org/d3.v6.min.js"></script>

    <script src="data/boston_neighborhoods.json"></script>
    <script src="data/201903-bluebikes-tripdata.csv"></script>
    <script src="process_data.js"></script>

    <script src="https://d3js.org/d3-array.v2.min.js"></script>
    <script src="https://d3js.org/d3-geo.v2.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v3.min.js"></script>
    <script src="https://d3js.org/d3-queue.v3.min.js"></script>

    <script src="https://d3js.org/d3-voronoi.v1.min.js"></script>

    <!-- <script src="./d3-simple-slider.js"></script><script src="https://d3js.org/d3.v6.min.js"></script> -->
    <script src="https://unpkg.com/d3-simple-slider"></script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous" />

</head>>

<body>
    <h1>hello</h1>
    <div class="row align-items-center">
        <div class="col-sm-2">
            <p id="value-simple"></p>
        </div>
        <div class="col-sm">
            <div id="slider-simple"></div>
        </div>
    </div>
    <h1>world</h1>

    <script src="heatmap_slider.js"></script>

    <script src="heatmap.js"></script>

    <script>
        console.log("Running javascript.")

        // Set up SVG 'canvas' with Boston map background
        var width = 700;
        var height = 580;

        var svg = d3.select("body")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        var gMap = svg.append("g")
            .attr("id", "map");

        // Set up other SVG groups now
        svg.append("g")
            .attr("id", "stations")

        svg.append("g")
            .attr("id", "heatmap")

        var albersProjection = d3.geoAlbers()
            .scale(190000)
            .rotate([71.057, 0])
            .center([0, 42.313])
            .translate([width / 2, height / 2]);

        var geoPath = d3.geoPath()
            .projection(albersProjection);

        gMap.selectAll("path")
            .data(neighborhoods_json.features)
            .enter()
            .append("path")
            .attr("fill", "#ccc")
            .attr("stroke", "#333")
            .attr("d", geoPath);

        // Load the Bluebike dataset 
        var files = []
        files.push("https://raw.githubusercontent.com/6859-sp21/a4-bikerides/main/bluebikes_2020_stations.csv")
        // files.push("https://raw.githubusercontent.com/6859-sp21/a4-bikerides/main/bluebikes_2020.csv")
        files.push("https://raw.githubusercontent.com/6859-sp21/a4-bikerides/bdnwang-voronoi/data/201909-bluebikes-tripdata.csv")

        var promises = []

        files.forEach(url => {
            promises.push(d3.csv(url))
        })

        // Initialize the heatmap with the dataset
        Promise.all(promises).then(values => {
            setupHeatmap(values[0], values[1])
        })

    </script>
</body>

</html>